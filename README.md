# KalmanId

This repository contains the code associated to the paper [*Identification of a Kalman Filter: Consistency of Local Solutions* by LÃ©o Simpson and Moritz Diehl](https://arxiv.org/pdf/2601.04198.pdf).

## The problem we are solving

We repeat the problem that we are solving, as described more in detailed in the paper (in particular, in eq. (1), (4) and (6)).

Consider a discrete-time linear time-invariant system in the innovation form:
```math
\begin{align*}
  x_{k+1} &= A x_k + B u_k + L e_k, \\
  y_k &= C x_k + e_k,
\end{align*}
```

where $x_k \in \mathbb{R}^{n_x}$ is the state, $y_k \in \mathbb{R}^{n_y}$ is the output, and $e_k \in \mathbb{R}^{n_y}$ i.i.d. with zero mean and covariance matrix $S \succ 0$. The matrices $A$, $B$, and $C$ are of appropriate dimensions.

The goal is to identify the Kalman gain $L$ from input-output data $\{u_k, y_k\}_{k=1}^N$ generated by the system, assuming that $A, B$ and $C$ are known. For that, we use prediction error method, which uses the state predictions $\hat{x}_k(L)$ defined by the following Kalman filter equations:

```math
\hat{x}_{k+1}(L) = A \hat{x}_k(L) + B u_k + L (y_k - C \hat{x}_k(L)).
```

Then, we solve the following optimization problem, for some constant $\alpha > 0$, and some weighting matrix $W \succ 0$:

```math
\begin{align*}
        \underset{L \in \mathbb{R}^{n_x \times n_y}, P \in \mathbb{R}^{n_x \times n_x} }{\text{minimize}} \;  &\frac{1}{N} \sum_{k=1}^N \lVert y_k - C \hat{x}_k(L) \rVert^2_{W}, \\
        \text{subject to} \quad
        &P = (A - L C) P (A -  L C)^\top + I, \\
        &  \alpha \text{Tr}(P-I) \leq 1, \\
        & P \succ 0.
\end{align*}
```

Much more details about the problem, the approach, and the experiments can be found in the paper.
Notably, the paper proves the consistency of this approach, even when only local solutions of the optimization problem are found.

## Organization of the files

* The files in the folder ``scripts/`` contain Python script that correspond to the experiments described in the paper,  section *5. NUMERICAL EXAMPLES*.

  * ``example1.py`` produces the figure ``images/illustration.pdf``, which corresponds to Fig. 1 in the paper. The experiment is described in the paper, paragraph *A one-dimensional illustrative example.*
  * ``example2_compute.py`` produces the data saved in ``savings/illustration_opt_data.pkl``, which is used in ``example2_plot.py``. The experiment is described in the paragraph *A two-state example.* (of the paper, section 5).
  * ``example2_plot.py`` produces the figure ``images/opti.pdf``, which corresponds to Fig. 2 in the paper.
  * ``example3_compute.py`` produces the data saved in ``savings/consistency_data.pkl``, which is used in ``example3_plot.py``. The experiment is described in the paragraph *A three-state position-acceleration example.* (of the paper, section 5).
  * ``example3_plot.py`` produces the figure ``images/consistency.pdf``, which corresponds to Fig. 3 in the paper.
  * ``example3_robustness.py`` produces an experiment regarding the robustness of the approach to different initializations. This experiment supports the sentence, in the paper *"as empirical evidence of the asymptotic unimodality of the cost, we generate [...] and  observe that all initializations lead to the same solution (up to tolerance) when N = 100.*
* the file ``run_all.py`` is a script that runs all of the other scripts in the folder ``scripts/`` in the correct order.
* the folder ``src/`` contains the source code for all the general functions needed in the scripts.Notably, it contains the code to formulate and solve the prediction error method.
* the folder ``images/`` contains the three images of the paper, generated by the scripts.
* the folder ``savings/`` contains data files generated by the scripts.
